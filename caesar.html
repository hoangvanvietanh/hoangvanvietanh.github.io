<!doctype html>
<html lang="en">

<head>
    <title>Bài 2</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row" style="margin-top: 50px;margin-bottom: 25px;">
            <div class="col-md-3">
                <a name="" id="" class="btn btn-success" style="width: 100%;" href="/index.html" role="button">Bài 1</a>
            </div>
            <div class="col-md-2">
                <a name="" id="" class="btn btn-info" style="width: 100%;" href="/caesar.html" role="button">Bài 2</a>
            </div>
            <div class="col-md-2">
                <a name="" id="" class="btn btn-danger" style="width: 100%;" href="/maHoaThayTheDG.html" role="button">Bài 3</a>
            </div>
            <div class="col-md-2">
                <a name="" id="" class="btn btn-warning" style="width: 100%;" href="/xuLyChuoi.html" role="button">Bài 4</a>
            </div>
            <div class="col-md-3">
                <a name="" id="" class="btn btn-primary" style="width: 100%;" href="/caculator.html" role="button">Bài 5</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">

            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="plainText">Chuỗi chưa mã hóa:</label>
                    <textarea class="form-control" name="" id="plainText" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="cipherText">Chuỗi sau khi mã hóa:</label>
                    <textarea class="form-control" name="" id="cipherText" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label for="key">Key K: </label>
                  <input type="text"
                    class="form-control" title="Nhập một kí tự từ A-Z hoặc số từ 1-25" name="" id="key" aria-describedby="helpId" placeholder="" size="1"
                    pattern="^[a-zA-Z0-9]{0,1}$">
                    <div id="errorMsg" class="error"></div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <button type="button" style="width: 100%;" onclick="btnEncrypt()" class="btn btn-success">Mã
                            hóa</button>
                    </div>
                    <div class="col-md-6">
                        <button type="button" style="width: 100%;" onclick="btnDecrypt()" class="btn btn-danger">Giải
                            mã</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3">

            </div>
        </div>
    </div>
    <section id="resultBruteforce"></section>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script>
        function btnEncrypt() {
            document.getElementById("resultBruteforce").innerHTML = "";
            var plainText = document.getElementById("plainText").value;
            if (plainText.length == 0) {
                document.getElementById("errorMsg").innerHTML = 'Chưa nhập Plain text kìa! :D';
                return;
            }
            var key = document.getElementById("key").value.toUpperCase();
            if ((isNaN(key) && key.length > 1) || (!isNaN(key) && key.length > 2) || (key.length == 0)) {
                document.getElementById("errorMsg").innerHTML = 'Khóa K bị rỗng hoặc sai!';
                return;
            }
            if (!isKeyValid(key)) {
                document.getElementById("errorMsg").innerHTML = 'Khóa K không hợp lệ.';
                return;
            }
            if (!isNaN(key)) {
                if ((parseInt(key) < 0) || (parseInt(key) > 26)) {
                    document.getElementById("errorMsg").innerHTML = 'Khóa K chỉ từ 0 đến 26';
                    return;
                }
                key = String.fromCharCode(parseInt(key) + 65);
            }
            //document.getElementById("key").value = key;
            var cipherText = crypt(plainText, key);
            document.getElementById("cipherText").value = cipherText;
            document.getElementById("errorMsg").innerHTML = "";
        }

        function crypt(text, key, isDecrypt = false) {
            var codeKey = key.charCodeAt() - 65;
            if (isDecrypt == true) {
                codeKey = 26 - codeKey;
            }
            var result = "";
            for (let i = 0; i < text.length; i++) {
                var codeTxt = text.charCodeAt(i);
                if (codeTxt >= 65 && codeTxt <= 90) {
                    let resultCode = ((codeTxt - 65) + codeKey) % 26;
                    result += String.fromCharCode(resultCode + 65);
                } else if (codeTxt >= 97 && codeTxt <= 122) {
                    let resultCode = ((codeTxt - 97) + codeKey) % 26;
                    result += String.fromCharCode(resultCode + 97);
                } else {
                    result += text.charAt(i);
                }
            }
            return result;
        }

        function btnDecrypt() {
            document.getElementById("resultBruteforce").innerHTML = "";
            var cipherText = document.getElementById("cipherText").value;
            if (cipherText.length == 0) {
                document.getElementById("errorMsg").innerHTML = 'Chưa nhập Cipher text kìa!';
                return;
            }
            document.getElementById("cipherText").value = cipherText;
            var key = document.getElementById("key").value.toUpperCase();
            if (key.length > 1) {
                document.getElementById("errorMsg").innerHTML = 'Khóa K chỉ một ký tự thôi nhé';
                return;
            } else if (key.length == 0) {
                document.getElementById("plainText").value = "";
                var result = "<b>Tổng hợp các trường hợp phá mã:</b><br/><table><tr><th><b>Key K</b></th><th><b>PlainText</b></th></tr>";
                for (let i = 65; i <= 90; i++) {
                    result += "<tr><td>" + String.fromCharCode(i) + "</td><td>" + crypt(cipherText, String.fromCharCode(i), true) + "</td></tr>";
                }
                result += "</table>";
                document.getElementById("resultBruteforce").innerHTML = result;
            } else {
                document.getElementById("key").value = key;
                var plainText = crypt(cipherText, key, true);
                document.getElementById("plainText").value = plainText;
            }

            document.getElementById("errorMsg").innerHTML = "";
        }

        function isKeyValid(key) {
            for (let i = 0; i < key.length; i++) {
                codeKey = key.charCodeAt(i);
                if (!((codeKey >= 65 && codeKey <= 90) || (codeKey >= 48 && codeKey <= 57))) {
                    return false;
                }
            }
            return true;
        }

    </script>
</body>

</html>